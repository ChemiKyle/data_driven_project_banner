{
    "name": "Data Driven Project Banner",
    "description": "Display a banner at the top of select project pages. Supports data piping of query results into the banner text.",
    "namespace": "ProjectBanner\\ExternalModule",
    "documentation": "README.md",
    "permissions": [
        "redcap_every_page_top",
        "redcap_module_configure_button_display"
    ],
    "authors": [
        {
            "name": "Kyle Chesney",
            "email": "kyle.chesney@ufl.edu",
            "institution": "University of Florida - CTSI"
        },
        {
            "name": "Taryn Stoffs",
            "email": "tls@ufl.edu",
            "institution": "University of Florida - CTSI"
        },
        {
            "name": "Philip Chase",
            "email": "pbc@ufl.edu",
            "institution": "University of Florida - CTSI"
        }
    ],
    "system-settings": [
        {
            "name": "Multi Row Response",
            "key": "multi_row_response",
            "type": "checkbox"
        },
        {
            "name": "Banner Top Text",
            "key": "banner_text_top",
            "type": "rich-text",
            "branchingLogic": {
                "conditions":
                [
                    {
                        "field": "multi_row_response",
                        "value": true
                    }
                ]
            }
        },
        {
            "name": "Banner Text",
            "key": "banner_text",
            "type": "rich-text"
        },
        {
            "name": "Banner Bottom Text",
            "key": "banner_text_bottom",
            "type": "rich-text",
            "branchingLogic": {
                "conditions":
                [
                    {
                        "field": "multi_row_response",
                        "value": true
                    }
                ]
            }
        },
        {
            "name": "Banner Background Color",
            "key": "bg_color",
            "type": "color-picker"
        },
        {
            "name": "Banner Border Color",
            "key": "border_color",
            "type": "color-picker"
        },
        {
            "name": "Criteria for display",
            "key": "criteria",
            "type": "dropdown",
            "choices": [
                {
                    "name": "Always display",
                    "value": "always"
                },
                {
                    "name": "Require a non-empty query result",
                    "value": "require_result"
                },
                {
                    "name": "Custom query",
                    "value": "custom"
                }
            ]
        },
        {
            "name": "Custom SQL for criteria",
            "key": "custom_criteria_sql",
            "type": "textarea",
            "branchingLogic": {
                "conditions":
                [
                    {
                        "field": "criteria",
                        "value": "custom"
                    }
                ]
            }
        },
        {
            "name": "Data to display",
            "key": "data_sql",
            "type": "dropdown",
            "choices": [
                {
                    "name": "REDCap projects table",
                    "value": "SELECT * FROM redcap_projects WHERE project_id = [project_id]"
                },
                {
                    "name": "UF: projects for which unpaid invoices were sent over 340 days ago",
                    "value": "SELECT *, concat(\"https://redcap.ctsi.ufl.edu/invoices/invoice-\", invoice_id, \".pdf\") as invoice_url FROM uf_annual_project_billing_invoices LEFT JOIN redcap_projects USING (project_id) WHERE project_id = [project_id] AND invoice_status = 'sent' AND datediff(now(), invoice_created_date) > 340;"
                },
                {
                    "name": "Custom",
                    "value": "custom"
                }
            ]
        },
        {
            "name": "Custom SQL for data",
            "key": "custom_data_sql",
            "type": "textarea",
            "branchingLogic": {
                "conditions":
                [
                    {
                        "field": "data_sql",
                        "value": "custom"
                    }
                ]
            }
        },
        {
            "name": "Display on all pages",
            "key": "display_everywhere",
            "type": "checkbox"
        }
    ],
    "compatibility": {
        "redcap-version-min": "8.0.3"
    }
}
